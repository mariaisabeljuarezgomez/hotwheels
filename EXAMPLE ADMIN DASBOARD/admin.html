<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - PlwgsCreativeApparel Business Management</title>
    <meta name="description" content="Comprehensive business management dashboard for PlwgsCreativeApparel - manage products, orders, analytics, and custom requests with dark futuristic interface." />
    <link rel="stylesheet" href="../css/main.css" />
    <style>
        /* Dashboard Specific Styles */
        .sidebar-nav {
            backdrop-filter: blur(10px);
            background: rgba(42, 42, 42, 0.95);
            border-right: 1px solid rgba(0, 188, 212, 0.2);
        }
        
        .glass-card {
            backdrop-filter: blur(15px);
            background: rgba(42, 42, 42, 0.8);
            border: 1px solid rgba(0, 188, 212, 0.2);
        }
        
        .metric-card {
            background: linear-gradient(135deg, rgba(0, 188, 212, 0.1), rgba(156, 39, 176, 0.1));
            border: 1px solid rgba(0, 188, 212, 0.3);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            border-color: rgba(0, 188, 212, 0.5);
            box-shadow: 0 0 20px rgba(0, 188, 212, 0.2);
        }
        
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 600;
        }
        
        .status-pending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .status-processing { background: rgba(0, 188, 212, 0.2); color: #00bcd4; }
        .status-shipped { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .status-completed { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .status-urgent { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        
        .chart-container {
            height: 300px;
            background: rgba(26, 26, 26, 0.8);
            border-radius: 0.75rem;
            padding: 1rem;
        }
        
        .kanban-column {
            background: rgba(42, 42, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 400px;
        }
        
        .kanban-card {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(0, 188, 212, 0.2);
            cursor: grab;
            transition: all 0.3s ease;
        }
        
        .kanban-card:hover {
            border-color: rgba(0, 188, 212, 0.5);
            transform: translateY(-2px);
        }
        
        .notification-dot {
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .progress-bar {
            background: rgba(0, 188, 212, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #00bcd4, #4dd0e1);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        /* Custom Scrollbar Styles */
        .scrollbar-thin::-webkit-scrollbar {
            width: 8px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: rgba(42, 42, 42, 0.5);
            border-radius: 4px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(0, 188, 212, 0.8);
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 188, 212, 1);
        }
        
        /* Firefox scrollbar */
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 188, 212, 0.8) rgba(42, 42, 42, 0.5);
        }
        
        /* Force scrollbar to always show */
        .scrollbar-thin {
            overflow-y: scroll !important;
        }
        
        /* Ensure content can actually overflow */
        .overflow-y-auto {
            overflow-y: auto !important;
        }
        

        
        /* Line clamp utility for text truncation */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar-nav {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar-nav.open {
                transform: translateX(0);
            }
        }
    </style>

</head>
<body class="bg-background text-text-primary overflow-x-hidden">
    <!-- Mobile Menu Overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"></div>

    <!-- Sidebar Navigation -->
    <aside id="sidebar" class="sidebar-nav fixed left-0 top-0 h-full w-64 z-50 transition-transform duration-300">
        <div class="p-6">
            <!-- Logo -->
            <div class="flex items-center space-x-3 mb-8">
                <svg class="w-8 h-8 text-accent" viewBox="0 0 40 40" fill="currentColor">
                    <path d="M20 2L37 12v16L20 38L3 28V12L20 2z"/>
                    <circle cx="20" cy="20" r="8" fill="#0a0a0a"/>
                    <text x="20" y="25" text-anchor="middle" class="text-xs font-bold fill-accent">P</text>
                </svg>
                <div>
                    <span class="font-orbitron text-lg font-bold text-gradient">PlwgsCreative</span>
                    <p class="text-text-secondary text-xs">Admin Dashboard</p>
                </div>
            </div>

            <!-- Navigation Menu -->
            <nav class="space-y-2">
                <a href="admin.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-accent bg-opacity-20 text-accent border border-accent border-opacity-30">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v0H8v0z"/>
                    </svg>
                    <span class="font-medium">Dashboard</span>
                </a>

                <a href="admin-uploads.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                    </svg>
                    <span>Products</span>
                    <div class="notification-dot ml-auto"></div>
                </a>

                <a href="orders.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                    </svg>
                    <span>Orders</span>
                    <span class="ml-auto bg-warning text-black text-xs px-2 py-1 rounded-full">0</span>
                </a>

                <a href="custom.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                    </svg>
                    <span>Custom Orders</span>
                    <span id="sidebarCustomOrdersCount" class="ml-auto bg-error text-white text-xs px-2 py-1 rounded-full">0</span>
                </a>

                <a href="customers.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                    </svg>
                    <span>Customers</span>
                </a>

                <a href="admin-login.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    <span>Analytics</span>
                </a>

                <a href="admin-login.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                    <span>Marketing</span>
                </a>

                <a href="admin-login.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                    </svg>
                    <span>Financials</span>
                </a>

                <a href="admin-uploads.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    <span>Uploads</span>
                </a>

                <a href="category-management.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                    </svg>
                    <span>Category Management</span>
                </a>
            </nav>

            <!-- Quick Actions -->
            <div class="mt-8 pt-6 border-t border-surface-light">
                <h3 class="text-text-secondary text-sm font-medium mb-4">Quick Actions</h3>
                <div class="space-y-2">
                    <button class="w-full text-left px-4 py-2 text-sm text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 rounded-lg transition-all duration-300">
                        Add New Product
                    </button>
                    <button class="w-full text-left px-4 py-2 text-sm text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 rounded-lg transition-all duration-300">
                        Process Orders
                    </button>
                    <button class="w-full text-left px-4 py-2 text-sm text-text-secondary hover:text-accent hover:bg-accent hover:bg-opacity-10 rounded-lg transition-all duration-300">
                        Send Newsletter
                    </button>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="lg:ml-64 min-h-screen">
        <!-- Top Header -->
        <header class="glass-card border-0 border-b border-surface-light p-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-btn" class="lg:hidden text-text-primary hover:text-accent transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                    
                    <div>
                        <h1 class="font-orbitron text-2xl font-bold text-white">Dashboard Overview</h1>
                        <p class="text-text-secondary text-sm">Welcome back, Lori! Here's what's happening with your store.</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <!-- Notifications -->
                    <div class="relative">
                    <button id="notifBtn" class="relative text-text-secondary hover:text-accent transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM11 17H7l4 4v-4zM13 3h4l-2 14h-4L13 3zM7 3h4l-2 14H5L7 3z"/>
                        </svg>
                        <div class="notification-dot absolute -top-1 -right-1"></div>
                    </button>
                    <div id="notifDropdown" class="hidden absolute right-0 mt-2 w-80 glass-card rounded-xl p-4 z-50">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-white text-sm font-medium">Notifications</h4>
                            <button id="markAllRead" class="text-accent text-xs">Mark all read</button>
                        </div>
                        <div id="notifList" class="space-y-2 max-h-64 overflow-y-auto"></div>
                        <div id="notifEmpty" class="text-text-secondary text-sm py-2 hidden">No new notifications</div>
                    </div>
                    </div>

                    <!-- View Store -->
                    <a href="homepage.html" class="btn-primary text-sm px-4 py-2">
                        View Store
                    </a>

                    <!-- Profile -->
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full border-2 border-accent bg-accent bg-opacity-20 flex items-center justify-center">
                            <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div class="hidden md:block">
                            <p class="text-white font-medium text-sm">Lori Nelton</p>
                            <p class="text-text-secondary text-xs">Store Owner</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <div class="p-6 space-y-8">
            <!-- Key Metrics -->
            <section>
                <h2 class="font-orbitron text-xl font-bold text-white mb-6">Key Metrics</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Daily Sales -->
                    <div class="metric-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-3 bg-accent bg-opacity-20 rounded-lg">
                                <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                                </svg>
                            </div>
                            <span class="text-success text-sm font-medium">+12.5%</span>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-1">$1,247</h3>
                        <p class="text-text-secondary text-sm">Daily Sales</p>
                        <div class="progress-bar mt-3">
                            <div class="progress-fill" style="width: 75%"></div>
                        </div>
                    </div>

                    <!-- Weekly Sales -->
                    <div class="metric-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-3 bg-neon-purple bg-opacity-20 rounded-lg">
                                <svg class="w-6 h-6 text-neon-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                </svg>
                            </div>
                            <span class="text-success text-sm font-medium">+8.2%</span>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-1">$8,934</h3>
                        <p class="text-text-secondary text-sm">Weekly Sales</p>
                        <div class="progress-bar mt-3">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                    </div>

                    <!-- Total Orders -->
                    <div class="metric-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-3 bg-warning bg-opacity-20 rounded-lg">
                                <svg class="w-6 h-6 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                                </svg>
                            </div>
                            <span class="text-success text-sm font-medium">+15.3%</span>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-1">342</h3>
                        <p class="text-text-secondary text-sm">Total Orders</p>
                        <div class="progress-bar mt-3">
                            <div class="progress-fill" style="width: 85%"></div>
                        </div>
                    </div>

                    <!-- Custom Requests -->
                    <div class="metric-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-3 bg-error bg-opacity-20 rounded-lg">
                                <svg class="w-6 h-6 text-error" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-error text-sm font-medium">Pending</span>
                                <button onclick="refreshCustomRequestsCount()" class="text-error hover:text-error-light transition-colors" title="Refresh count">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-1">0</h3>
                        <p class="text-text-secondary text-sm">Custom Requests</p>
                        <div class="progress-bar mt-3">
                            <div class="progress-fill bg-error" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Charts and Analytics -->
            <section class="grid lg:grid-cols-2 gap-8">
                <!-- Sales Chart -->
                <div class="glass-card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-orbitron text-lg font-bold text-white">Sales Overview</h3>
                        <select id="sales-period" class="bg-surface border border-surface-light text-text-primary px-3 py-1 rounded-lg text-sm">
                            <option value="7d">Last 7 days</option>
                            <option value="30d">Last 30 days</option>
                            <option value="90d">Last 3 months</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <svg class="w-full h-full" viewBox="0 0 400 200">
                            <!-- Chart Grid -->
                            <defs>
                                <pattern id="grid" width="40" height="20" patternUnits="userSpaceOnUse">
                                    <path d="M 40 0 L 0 0 0 20" fill="none" stroke="rgba(160, 160, 160, 0.1)" stroke-width="1"/>
                                </pattern>
                            </defs>
                            <rect width="100%" height="100%" fill="url(#grid)"/>
                            
                            <!-- Sales Line -->
                            <polyline fill="none" stroke="#00bcd4" stroke-width="3" points="20,150 60,120 100,140 140,100 180,110 220,80 260,90 300,60 340,70 380,40"/>
                            
                            <!-- Data Points -->
                            <circle cx="20" cy="150" r="4" fill="#00bcd4"/>
                            <circle cx="60" cy="120" r="4" fill="#00bcd4"/>
                            <circle cx="100" cy="140" r="4" fill="#00bcd4"/>
                            <circle cx="140" cy="100" r="4" fill="#00bcd4"/>
                            <circle cx="180" cy="110" r="4" fill="#00bcd4"/>
                            <circle cx="220" cy="80" r="4" fill="#00bcd4"/>
                            <circle cx="260" cy="90" r="4" fill="#00bcd4"/>
                            <circle cx="300" cy="60" r="4" fill="#00bcd4"/>
                            <circle cx="340" cy="70" r="4" fill="#00bcd4"/>
                            <circle cx="380" cy="40" r="4" fill="#00bcd4"/>
                        </svg>
                    </div>
                </div>

                <!-- Top Products -->
                <div class="glass-card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-orbitron text-lg font-bold text-white">Top Performing Designs</h3>
                        <button onclick="forceRefreshTopProducts()" class="text-accent hover:text-accent-light text-xs px-3 py-1 border border-accent rounded transition-colors" title="Force refresh">
                            ðŸ”„ Refresh
                        </button>
                            </div>
                    <div id="topProductsContainer" class="space-y-4">
                        <!-- Dynamic content will be loaded here -->
                        <div class="text-center text-text-secondary text-sm py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-accent mx-auto mb-3"></div>
                            <p class="text-text-secondary">Loading top products...</p>
                            <p class="text-xs text-gray-500 mt-2">This will show your best-selling designs with actual product images</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Stats Summary -->
            <section class="mb-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="glass-card rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold text-accent mb-1" id="totalOrdersCount">0</div>
                        <div class="text-text-secondary text-sm">Total Orders</div>
                    </div>
                    <div class="glass-card rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold text-warning mb-1" id="pendingOrdersCount">0</div>
                        <div class="text-text-secondary text-sm">Pending</div>
                    </div>
                    <div class="glass-card rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold text-accent mb-1" id="processingOrdersCount">0</div>
                        <div class="text-text-secondary text-sm">Processing</div>
                    </div>
                    <div class="glass-card rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold text-success mb-1" id="completedOrdersCount">0</div>
                        <div class="text-text-secondary text-sm">Completed</div>
                    </div>
                </div>
            </section>

            <!-- Order Management Kanban -->
            <section>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="font-orbitron text-xl font-bold text-white">Order Management</h2>
                    <div class="flex space-x-3">
                        <button id="processAllOrdersBtn" class="btn-primary text-sm px-4 py-2">Process All</button>
                        <button id="exportOrdersBtn" class="border border-accent text-accent px-4 py-2 rounded-lg text-sm hover:bg-accent hover:text-black transition-all duration-300">
                            Export Orders
                        </button>
                        <button onclick="toggleOrderView()" class="text-accent hover:text-accent-light text-sm px-3 py-2 border border-accent rounded-lg transition-all duration-300">
                            <span id="orderViewToggle">Compact View</span>
                        </button>
                    </div>
                </div>

                <div class="grid md:grid-cols-4 gap-6">
                    <!-- Pending Orders -->
                    <div class="kanban-column rounded-xl p-4" data-status="pending">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-medium text-white">Pending</h3>
                            <span class="status-badge status-pending">0</span>
                        </div>
                        <div class="space-y-3 max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-accent scrollbar-track-surface-dark">
                            <div class="kanban-card rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white font-medium text-sm">#ORD-2847</span>
                                    <span class="text-text-secondary text-xs">2h ago</span>
                                </div>
                                <p class="text-text-secondary text-sm mb-2">Horror Skull Tee - Size L</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-accent font-bold text-sm">$24.99</span>
                                    <span class="text-text-secondary text-xs">Sarah M.</span>
                                </div>
                            </div>

                            <div class="kanban-card rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white font-medium text-sm">#ORD-2846</span>
                                    <span class="text-text-secondary text-xs">4h ago</span>
                                </div>
                                <p class="text-text-secondary text-sm mb-2">Pop Culture Mashup - Size M</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-accent font-bold text-sm">$26.99</span>
                                    <span class="text-text-secondary text-xs">Mike R.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Processing Orders -->
                    <div class="kanban-column rounded-xl p-4" data-status="processing">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-medium text-white">Processing</h3>
                            <span class="status-badge status-processing">0</span>
                        </div>
                        <div class="space-y-3 max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-accent scrollbar-track-surface-dark">
                            <div class="kanban-card rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white font-medium text-sm">#ORD-2845</span>
                                    <span class="text-text-secondary text-xs">6h ago</span>
                                </div>
                                <p class="text-text-secondary text-sm mb-2">Custom Design Request</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-accent font-bold text-sm">$34.99</span>
                                    <span class="text-text-secondary text-xs">Alex K.</span>
                                </div>
                            </div>

                            <div class="kanban-card rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white font-medium text-sm">#ORD-2844</span>
                                    <span class="text-text-secondary text-xs">8h ago</span>
                                </div>
                                <p class="text-text-secondary text-sm mb-2">Sarcastic Quote Tee - Size XL</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-accent font-bold text-sm">$24.99</span>
                                    <span class="text-text-secondary text-xs">Jenny L.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shipped Orders -->
                    <div class="kanban-column rounded-xl p-4" data-status="shipped">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-medium text-white">Shipped</h3>
                            <span class="status-badge status-processing">0</span>
                        </div>
                        <div class="space-y-3 max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-accent scrollbar-track-surface-dark">
                            <div class="kanban-card rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white font-medium text-sm">#ORD-2843</span>
                                    <span class="text-text-secondary text-xs">1d ago</span>
                                </div>
                                <p class="text-text-secondary text-sm mb-2">Minimalist Rebel - Size S</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-accent font-bold text-sm">$22.99</span>
                                    <span class="text-text-secondary text-xs">David P.</span>
                                </div>
                            </div>

                            <div class="kanban-card rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white font-medium text-sm">#ORD-2842</span>
                                    <span class="text-text-secondary text-xs">1d ago</span>
                                </div>
                                <p class="text-text-secondary text-sm mb-2">Horror Collection Bundle</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-accent font-bold text-sm">$67.97</span>
                                    <span class="text-text-secondary text-xs">Emma T.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Completed Orders -->
                    <div class="kanban-column rounded-xl p-4" data-status="completed">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-medium text-white">Completed</h3>
                            <span class="status-badge status-completed">0</span>
                        </div>
                        <div class="space-y-3 max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-accent scrollbar-track-surface-dark">
                            <div class="kanban-card rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white font-medium text-sm">#ORD-2841</span>
                                    <span class="text-text-secondary text-xs">2d ago</span>
                                </div>
                                <p class="text-text-secondary text-sm mb-2">Pop Culture Tee - Size M</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-success font-bold text-sm">$26.99</span>
                                    <span class="text-text-secondary text-xs">Lisa W.</span>
                                </div>
                            </div>

                            <div class="kanban-card rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white font-medium text-sm">#ORD-2840</span>
                                    <span class="text-text-secondary text-xs">2d ago</span>
                                </div>
                                <p class="text-text-secondary text-sm mb-2">Custom Wedding Tees (x5)</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-success font-bold text-sm">$124.95</span>
                                    <span class="text-text-secondary text-xs">Rachel B.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Inventory Alerts & Custom Requests -->
            <section class="grid lg:grid-cols-2 gap-8">
                <!-- Inventory Alerts -->
                <div class="glass-card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-orbitron text-lg font-bold text-white">Inventory Alerts</h3>
                        <span class="status-badge status-urgent">5 Low Stock</span>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-4 p-3 bg-surface-dark rounded-lg border border-error border-opacity-30">
                            <div class="w-3 h-3 bg-error rounded-full"></div>
                            <div class="flex-1">
                                <h4 class="text-white font-medium text-sm">Horror Skull Tee - Size L</h4>
                                <p class="text-text-secondary text-xs">Only 3 left in stock</p>
                            </div>
                            <button class="text-accent hover:text-accent-light text-sm">Reorder</button>
                        </div>

                        <div class="flex items-center space-x-4 p-3 bg-surface-dark rounded-lg border border-warning border-opacity-30">
                            <div class="w-3 h-3 bg-warning rounded-full"></div>
                            <div class="flex-1">
                                <h4 class="text-white font-medium text-sm">Pop Culture Mashup - Size M</h4>
                                <p class="text-text-secondary text-xs">7 left in stock</p>
                            </div>
                            <button class="text-accent hover:text-accent-light text-sm">Reorder</button>
                        </div>

                        <div class="flex items-center space-x-4 p-3 bg-surface-dark rounded-lg border border-error border-opacity-30">
                            <div class="w-3 h-3 bg-error rounded-full"></div>
                            <div class="flex-1">
                                <h4 class="text-white font-medium text-sm">Sarcastic Quote Tee - Size XL</h4>
                                <p class="text-text-secondary text-xs">Only 2 left in stock</p>
                            </div>
                            <button class="text-accent hover:text-accent-light text-sm">Reorder</button>
                        </div>
                    </div>
                </div>

                <!-- Custom Order Requests -->
                <div class="glass-card rounded-xl p-6">
                            <div class="flex items-center justify-between mb-6">
            <h3 class="font-orbitron text-lg font-bold text-white">Custom Requests</h3>
            <div class="flex items-center space-x-2">
                <button onclick="testCustomInputAPI()" class="text-accent hover:text-accent-light text-xs px-2 py-1 border border-accent rounded">Test API</button>
                <button onclick="loadCustomRequests()" class="text-accent hover:text-accent-light text-xs px-2 py-1 border border-accent rounded">Load Now</button>
                <a href="custom.html" class="text-accent hover:text-accent-light text-sm">View All</a>
            </div>
        </div>
        <div id="customRequestsContainer" class="space-y-4 max-h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-accent scrollbar-track-surface-dark">
                        <div id="customRequestsLoading" class="text-center py-6">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
                            <p class="text-text-secondary mt-2">Loading custom requests...</p>
                        </div>
                        <div id="customRequestsEmpty" class="text-center py-6 hidden text-text-secondary text-sm">
                            No custom requests found
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recent Activity -->
            <section>
                <div class="glass-card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-orbitron text-lg font-bold text-white">Recent Activity</h3>
                        <button id="refreshActivity" class="text-text-secondary hover:text-accent text-sm">Refresh</button>
                    </div>
                    <div id="activityLoading" class="text-center py-6 hidden">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
                        <p class="text-text-secondary mt-2">Loading activity...</p>
                    </div>
                    <div id="activityEmpty" class="text-center py-6 hidden text-text-secondary text-sm">No recent activity</div>
                    <div id="activityList" class="space-y-4 max-h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-accent scrollbar-track-surface-dark"></div>
                </div>
            </section>

            <!-- Newsletter Subscribers -->
            <section>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="font-orbitron text-xl font-bold text-white">Newsletter Subscribers</h2>
                    <div class="flex space-x-3">
                        <button id="refreshSubscribers" class="btn-primary text-sm px-4 py-2">Refresh</button>
                        <button id="exportSubscribers" class="border border-accent text-accent px-4 py-2 rounded-lg text-sm hover:bg-accent hover:text-black transition-all duration-300">
                            Export CSV
                        </button>
                    </div>
                </div>

                <div class="glass-card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-white font-medium text-lg">Subscriber List</h3>
                            <p class="text-text-secondary text-sm">Manage your newsletter subscribers</p>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-accent" id="subscriberCount">0</p>
                            <p class="text-text-secondary text-xs">Total Subscribers</p>
                        </div>
                    </div>

                    <div class="overflow-x-auto max-h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-accent scrollbar-track-surface-dark">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-surface-light">
                                    <th class="text-text-secondary text-sm font-medium pb-3">Email</th>
                                    <th class="text-text-secondary text-sm font-medium pb-3">Name</th>
                                    <th class="text-text-secondary text-sm font-medium pb-3">Subscribed</th>
                                    <th class="text-text-secondary text-sm font-medium pb-3">Status</th>
                                    <th class="text-text-secondary text-sm font-medium pb-3">Welcome Email</th>
                                    <th class="text-text-secondary text-sm font-medium pb-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="subscribersTableBody">
                                <!-- Subscribers will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <div id="subscribersLoading" class="text-center py-8 hidden">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
                        <p class="text-text-secondary mt-2">Loading subscribers...</p>
                    </div>

                    <div id="subscribersEmpty" class="text-center py-8 hidden">
                        <svg class="w-12 h-12 text-text-secondary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        <p class="text-text-secondary">No subscribers yet</p>
                        <p class="text-text-secondary text-sm">Subscribers will appear here once they sign up</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // Authentication check
        function checkAuth() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = 'admin-login.html';
                return false;
            }
            return token;
        }

        // API request helper
        async function apiRequest(url, options = {}) {
            const token = checkAuth();
            if (!token) return null;

            const response = await fetch(url, {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                    ...options.headers
                }
            });

            if (response.status === 401) {
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                window.location.href = 'admin-login.html';
                return null;
            }

            return response;
        }

        // Logout function
        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUser');
            window.location.href = 'admin-login.html';
        }

        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');
        const mobileOverlay = document.getElementById('mobile-overlay');

        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            mobileOverlay.classList.toggle('hidden');
        });

        mobileOverlay.addEventListener('click', () => {
            sidebar.classList.remove('open');
            mobileOverlay.classList.add('hidden');
        });

        // Load real dashboard data
        async function loadDashboardData() {
            try {
                const periodSel = document.getElementById('sales-period');
                const period = periodSel ? periodSel.value : '7d';
                const response = await apiRequest(`/api/analytics/dashboard?period=${encodeURIComponent(period)}`);
                if (!response) return;
                
                const data = await response.json();
                
                if (response.ok) {
                    updateMetrics(data.sales);
                    updateTopProducts(data.topProducts);
                    updateLowStockAlerts(data.lowStock);
                    updateCustomRequestsMetric(data.customRequestsCount || 0);
                }
                
                // Load custom requests after dashboard data
                loadCustomRequests();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        // Load chart series based on dropdown selection and redraw chart
        async function loadSalesSeries(period) {
            try {
                const response = await apiRequest(`/api/analytics/sales-series?period=${encodeURIComponent(period)}`);
                if (!response) return;
                const data = await response.json();
                if (response.ok) {
                    redrawSalesChart(data.series || []);
                }
            } catch (e) { console.error('Error loading sales series:', e); }
        }

        function redrawSalesChart(series) {
            const svg = document.querySelector('.chart-container svg');
            if (!svg) return;
            // Build points across width
            const width = 400; const height = 200; const leftPad = 20; const bottom = 160;
            const max = Math.max(1, ...series.map(p => Number(p.total)));
            const step = series.length > 1 ? (width - 40) / (series.length - 1) : 0;
            const points = series.map((p, i) => {
                const x = leftPad + i * step;
                const y = bottom - (Number(p.total) / max) * 120; // scale in 120px range
                return `${x},${y}`;
            }).join(' ');
            const poly = svg.querySelector('polyline');
            if (poly) poly.setAttribute('points', points || `${leftPad},${bottom}`);
            // No-data hint text
            const existingMsg = svg.querySelector('text.no-data');
            if (series.length === 0 || series.every(p => Number(p.total) === 0)) {
                if (!existingMsg) {
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', '200');
                    text.setAttribute('y', '100');
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('class', 'no-data');
                    text.setAttribute('fill', 'rgba(160,160,160,0.4)');
                    text.textContent = 'No sales data for selected period';
                    svg.appendChild(text);
                }
            } else if (existingMsg) {
                existingMsg.remove();
            }
        }

        // Update metrics with real data
        function updateMetrics(salesData) {
            const dailySalesElement = document.querySelector('.metric-card:nth-child(1) h3');
            const weeklySalesElement = document.querySelector('.metric-card:nth-child(2) h3');
            const totalOrdersElement = document.querySelector('.metric-card:nth-child(3) h3');
            
            if (dailySalesElement) {
                dailySalesElement.textContent = '$' + (salesData.total_sales || 0).toLocaleString();
            }
            if (weeklySalesElement) {
                weeklySalesElement.textContent = '$' + (salesData.total_sales || 0).toLocaleString();
            }
            if (totalOrdersElement) {
                totalOrdersElement.textContent = (salesData.total_orders || 0).toLocaleString();
            }
        }

        // Update custom requests metric card
        function updateCustomRequestsMetric(count) {
            const customReqCardValue = document.querySelector('.metric-card:nth-child(4) h3');
            const customReqProgressBar = document.querySelector('.metric-card:nth-child(4) .progress-fill');
            const sidebarCount = document.getElementById('sidebarCustomOrdersCount');
            
            if (customReqCardValue) {
                customReqCardValue.textContent = count.toString();
            }
            
            // Update sidebar count
            if (sidebarCount) {
                sidebarCount.textContent = count.toString();
                
                // Update sidebar badge color based on urgency
                if (count === 0) {
                    sidebarCount.className = 'ml-auto bg-success text-white text-xs px-2 py-1 rounded-full';
                } else if (count <= 5) {
                    sidebarCount.className = 'ml-auto bg-accent text-white text-xs px-2 py-1 rounded-full';
                } else if (count <= 10) {
                    sidebarCount.className = 'ml-auto bg-warning text-black text-xs px-2 py-1 rounded-full';
                } else {
                    sidebarCount.className = 'ml-auto bg-error text-white text-xs px-2 py-1 rounded-full';
                }
            }
            
            if (customReqProgressBar) {
                // Set progress bar width based on count (max 100% for 20+ requests)
                const progressWidth = Math.min((count / 20) * 100, 100);
                customReqProgressBar.style.width = progressWidth + '%';
                
                // Update progress bar color based on urgency
                if (count === 0) {
                    customReqProgressBar.style.background = 'rgba(16, 185, 129, 0.8)'; // Green for no pending
                } else if (count <= 5) {
                    customReqProgressBar.style.background = 'rgba(0, 188, 212, 0.8)'; // Blue for low
                } else if (count <= 10) {
                    customReqProgressBar.style.background = 'rgba(245, 158, 11, 0.8)'; // Yellow for medium
                } else {
                    customReqProgressBar.style.background = 'rgba(239, 68, 68, 0.8)'; // Red for high
                }
            }
        }

        // Force refresh top products
        function forceRefreshTopProducts() {
            // Clear the container and show loading
            const topProductsContainer = document.getElementById('topProductsContainer');
            if (topProductsContainer) {
                topProductsContainer.innerHTML = `
                    <div class="text-center text-text-secondary text-sm py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-accent mx-auto mb-3"></div>
                        <p class="text-text-secondary">Refreshing top products...</p>
                        <p class="text-xs text-gray-500 mt-2">Fetching latest data from database</p>
                    </div>
                `;
            }
            // Reload dashboard data
            loadDashboardData();
        }



        // Update top products
        function updateTopProducts(products) {
            const topProductsContainer = document.getElementById('topProductsContainer');
            if (!topProductsContainer) {
                console.error('Top products container not found');
                return;
            }
            if (!products) {
                return;
            }
            
            if (!products.length) {
                topProductsContainer.innerHTML = `
                    <div class="text-center text-text-secondary text-sm py-8">
                        <div class="w-16 h-16 mx-auto mb-4 text-gray-500">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                            </svg>
                        </div>
                        <p class="text-text-secondary mb-2">No top products for the selected period</p>
                        <p class="text-xs text-gray-500">Products will appear here once you have sales data</p>
                    </div>
                `;
                return;
            }

            topProductsContainer.innerHTML = products.map((product, index) => {
                // Validate product data
                if (!product || !product.product_name) {
                    console.warn(`âš ï¸ Skipping invalid product at index ${index}:`, product);
                    return '';
                }
                
                // Get image URL from product data
                let imageUrl = product.image_url || '';
                
                if (imageUrl && imageUrl.includes('cloudinary.com')) {
                    // Transform Cloudinary URL for optimal thumbnail size and quality
                    imageUrl = imageUrl.replace('/upload/', '/upload/c_fill,g_auto,w_80,h_80,q_auto,f_auto/');
                }
                
                // Ensure numeric values are properly handled
                const totalSold = parseInt(product.total_sold) || 0;
                const totalRevenue = parseFloat(product.total_revenue) || 0;
                
                return `
                    <div class="flex items-center space-x-4 p-3 bg-surface-dark rounded-lg hover:bg-surface-light transition-colors duration-200">
                        <div class="relative">
                            <img src="${imageUrl}" 
                                 alt="${product.product_name}" 
                                 class="w-16 h-16 rounded-lg object-cover border border-surface-light" 
                                 loading="lazy" />
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-accent rounded-full flex items-center justify-center">
                                <span class="text-xs font-bold text-black">${index + 1}</span>
                            </div>
                        </div>
                    <div class="flex-1">
                        <h4 class="text-white font-medium text-sm">${product.product_name}</h4>
                            <p class="text-text-secondary text-xs">${totalSold} sold this week</p>
                    </div>
                    <div class="text-right">
                            <p class="text-accent font-bold text-sm">$${totalRevenue.toFixed(2)}</p>
                        <p class="text-success text-xs">+${Math.floor(Math.random() * 20 + 10)}%</p>
                    </div>
                </div>
                `;
            }).join('');
        }

        // Update low stock alerts
        function updateLowStockAlerts(lowStockItems) {
            const inventoryContainer = document.querySelector('.glass-card:nth-child(1) .space-y-4');
            if (!inventoryContainer || !lowStockItems) return;
            
            if (!lowStockItems.length) {
                inventoryContainer.innerHTML = `<div class="text-center text-text-secondary text-sm py-4">No low stock items</div>`;
                return;
            }

            inventoryContainer.innerHTML = lowStockItems.map(item => `
                <div class="flex items-center space-x-4 p-3 bg-surface-dark rounded-lg border ${item.stock_quantity === 0 ? 'border-error border-opacity-30' : 'border-warning border-opacity-30'}">
                    <div class="w-3 h-3 ${item.stock_quantity === 0 ? 'bg-error' : 'bg-warning'} rounded-full"></div>
                    <div class="flex-1">
                        <h4 class="text-white font-medium text-sm">${item.name}</h4>
                        <p class="text-text-secondary text-xs">${item.stock_quantity === 0 ? 'Out of stock' : `${item.stock_quantity} left in stock`}</p>
                    </div>
                    ${item.product_id ? `<a class="text-accent hover:text-accent-light text-sm" href="product-edit.html?id=${item.product_id}">Reorder</a>` : `<button class="text-accent hover:text-accent-light text-sm" disabled>Reorder</button>`}
                </div>
            `).join('');
        }

        // Load recent activity
        async function loadActivity() {
            try {
                const loading = document.getElementById('activityLoading');
                const emptyEl = document.getElementById('activityEmpty');
                const listEl = document.getElementById('activityList');
                if (loading) loading.classList.remove('hidden');
                if (emptyEl) emptyEl.classList.add('hidden');
                if (listEl) listEl.innerHTML = '';

                const response = await apiRequest('/api/admin/activity?limit=20');
                if (!response) return;
                const data = await response.json();
                if (!response.ok) return;

                const items = data.activity || [];
                if (items.length === 0) {
                    if (emptyEl) emptyEl.classList.remove('hidden');
                    return;
                }
                if (listEl) listEl.innerHTML = items.map(renderActivityItem).join('');
            } catch (e) {
                console.error('Error loading activity:', e);
            } finally {
                const loading = document.getElementById('activityLoading');
                if (loading) loading.classList.add('hidden');
            }
        }

        function renderActivityItem(item) {
            const colorClass = item.type === 'order' ? 'bg-success' :
                              item.type === 'product' ? 'bg-neon-purple' :
                              item.type === 'inventory' ? 'bg-warning' :
                              item.type === 'custom_request' ? 'bg-accent' : 'bg-text-secondary';
            const right = item.amount ? `<span class="text-accent font-bold text-sm">$${Number(item.amount).toFixed(2)}</span>` : (item.type === 'order' ? '<span class="text-success font-bold text-sm">Order</span>' : '');
            const subtitle = item.subtitle ? `<p class="text-text-secondary text-xs">${item.subtitle}</p>` : '';
            const time = item.created_at ? `<span class="text-text-secondary text-xs">${formatTimeAgo(item.created_at)}</span>` : '';
            const link = item.link ? `<a class="text-accent hover:text-accent-light text-sm" href="${resolveActivityLink(item.link)}">View</a>` : '';
            return `
                <div class="flex items-start space-x-4 p-3 bg-surface-dark rounded-lg">
                    <div class="w-2 h-2 ${colorClass} rounded-full mt-2"></div>
                    <div class="flex-1">
                        <p class="text-white text-sm">${item.title || 'Activity'}</p>
                        ${subtitle}
                        ${time}
                    </div>
                    ${link || right}
                </div>
            `;
        }

        function resolveActivityLink(link) {
            // Link format examples from server: 'order:ID', 'product:ID'
            if (!link) return '#';
            if (link.startsWith('order:')) return 'orders.html';
            if (link.startsWith('product:')) return 'admin-uploads.html';
            return '#';
        }

        // Load orders data
        async function loadOrders() {
            try {
                const response = await apiRequest('/api/orders?limit=20');
                if (!response) return;
                
                const data = await response.json();
                
                if (response.ok) {
                    updateOrderKanban(data.orders);
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        // Update order kanban board
        function updateOrderKanban(orders) {
            const statuses = ['pending', 'processing', 'shipped', 'completed'];
            
            // Update summary counts
            const totalOrders = orders.length;
            const pendingCount = orders.filter(order => order.status === 'pending').length;
            const processingCount = orders.filter(order => order.status === 'processing').length;
            const completedCount = orders.filter(order => order.status === 'completed').length;
            
            // Update summary cards
            const totalElement = document.getElementById('totalOrdersCount');
            const pendingElement = document.getElementById('pendingOrdersCount');
            const processingElement = document.getElementById('processingOrdersCount');
            const completedElement = document.getElementById('completedOrdersCount');
            
            if (totalElement) totalElement.textContent = totalOrders;
            if (pendingElement) pendingElement.textContent = pendingCount;
            if (processingElement) processingElement.textContent = processingCount;
            if (completedElement) completedElement.textContent = completedCount;
            
            statuses.forEach(status => {
                const column = document.querySelector(`[data-status="${status}"]`);
                if (!column) return;
                
                const statusOrders = orders.filter(order => order.status === status);
                const orderContainer = column.querySelector('.space-y-3');
                
                if (orderContainer) {
                    orderContainer.innerHTML = statusOrders.map(order => {
                        const next = getNextStatus(order.status);
                        const actionBtn = next ? `<button class="text-xs border border-accent text-accent px-2 py-1 rounded hover:bg-accent hover:text-black transition-all duration-300" onclick="updateOrderStatus(${order.id}, '${next}')">${labelForStatus(next)}</button>` : '';
                        
                        // Get product information from order items
                        let productInfo = 'Product details unavailable';
                        if (order.order_items && Array.isArray(order.order_items) && order.order_items.length > 0) {
                            productInfo = order.order_items.map(item => {
                                const size = item.size ? ` - ${item.size}` : '';
                                const color = item.color ? ` (${item.color})` : '';
                                return `${item.product_name}${size}${color} (${item.quantity}x)`;
                            }).join(', ');
                        }
                        
                        // Format customer name (show first name + last initial)
                        const customerName = order.customer_name || 'Customer';
                        const customerDisplay = customerName.includes(' ') 
                            ? customerName.split(' ')[0] + ' ' + customerName.split(' ')[1].charAt(0) + '.'
                            : customerName;
                        
                        return `
                        <div class="kanban-card rounded-lg p-3 cursor-pointer" draggable="true" data-order-id="${order.id}" title="Click to view full details" onclick="showOrderDetails(${order.id})">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-white font-medium text-xs">${order.order_number}</span>
                                <span class="text-text-secondary text-xs">${formatTimeAgo(order.created_at)}</span>
                            </div>
                            <p class="text-text-secondary text-xs mb-1 line-clamp-2">${productInfo}</p>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-accent font-bold text-xs">$${parseFloat(order.total_amount || 0).toFixed(2)}</span>
                                <span class="text-text-secondary text-xs">${customerDisplay}</span>
                            </div>
                            <div class="flex justify-end">
                                ${actionBtn}
                            </div>
                        </div>`;
                    }).join('');
                }
                const badge = column.querySelector('.status-badge');
                if (badge) badge.textContent = String(statusOrders.length);
            });

            initKanbanDnD();
        }

        function getNextStatus(current) {
            if (current === 'pending') return 'processing';
            if (current === 'processing') return 'shipped';
            if (current === 'shipped') return 'completed';
            return null;
        }
        function labelForStatus(status) {
            if (status === 'processing') return 'Mark Processing';
            if (status === 'shipped') return 'Mark Shipped';
            if (status === 'completed') return 'Mark Completed';
            return 'Update';
        }

        function initKanbanDnD() {
            let draggedOrderId = null;
            document.querySelectorAll('.kanban-card').forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    draggedOrderId = card.getAttribute('data-order-id');
                    e.dataTransfer.effectAllowed = 'move';
                });
                card.addEventListener('dragend', () => { draggedOrderId = null; });
            });

            document.querySelectorAll('.kanban-column').forEach(col => {
                col.addEventListener('dragover', (e) => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
                col.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    const newStatus = col.getAttribute('data-status');
                    if (!draggedOrderId || !newStatus) return;
                    const ok = confirm(`Move order #${draggedOrderId} to ${newStatus}?`);
                    if (!ok) return;
                    await updateOrderStatus(draggedOrderId, newStatus);
                });
            });
        }

        async function updateOrderStatus(orderId, status) {
            try {
                const response = await apiRequest(`/api/orders/${orderId}/status`, {
                    method: 'PATCH',
                    body: JSON.stringify({ status })
                });
                if (response && response.ok) {
                    showNotification('Order status updated', 'success');
                    await loadOrders();
                    
                    // Always refresh custom requests to show updated status
                    await loadCustomRequests();
                    
                    // If order was marked as completed, refresh dashboard metrics to update custom requests count
                    if (status === 'completed') {
                        await loadDashboardData();
                    }
                } else {
                    showNotification('Failed to update order status', 'error');
                }
            } catch (e) {
                console.error('Error updating order status:', e);
                showNotification('Error updating order status', 'error');
            }
        }

        // Format time ago
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInHours = Math.floor((now - date) / (1000 * 60 * 60));
            
            if (diffInHours < 1) return 'Just now';
            if (diffInHours < 24) return `${diffInHours}h ago`;
            if (diffInHours < 48) return '1d ago';
            return `${Math.floor(diffInHours / 24)}d ago`;
        }

        // Format custom input data for display
        function formatCustomInputDescription(customInput) {
            if (!customInput) return 'No custom input';

            let description = '';
            const inputData = typeof customInput === 'string' ? JSON.parse(customInput) : customInput;

            // Display standard custom inputs
            const standardFields = Object.keys(inputData).filter(key =>
                (key.includes('birthday_') || key.includes('lyrics_')) &&
                !key.includes('custom_question')
            );

            if (standardFields.length > 0) {
                description += 'Custom details: ';
                const displayFields = standardFields.map(key => {
                    const displayKey = key.replace('birthday_', '').replace('lyrics_', '').replace(/_/g, ' ');
                    return `${displayKey}: ${inputData[key]}`;
                });
                description += displayFields.join(', ');
            }

            // Display custom questions prominently
            const customQuestions = Object.keys(inputData).filter(key => key.includes('custom_question'));
            if (customQuestions.length > 0) {
                if (description) description += ' | ';
                description += 'ðŸŽ¯ CUSTOM QUESTIONS: ';
                const questionResponses = customQuestions.map(key => {
                    const questionType = key.includes('birthday') ? 'Birthday' : 'Lyrics';
                    return `${questionType}: "${inputData[key]}"`;
                });
                description += questionResponses.join(' | ');
            }

            return description || 'Custom order with additional details';
        }

        // Load custom requests and orders with custom input
        async function loadCustomRequests() {
            try {
                // Load both custom requests and orders with custom input
                const [customRequestsResponse, customOrdersResponse] = await Promise.all([
                    apiRequest('/api/custom-requests?limit=3'),
                    apiRequest('/api/orders/custom-input?limit=3')
                ]);
                
                let allRequests = [];
                
                // Add custom requests
                if (customRequestsResponse && customRequestsResponse.ok) {
                    const customData = await customRequestsResponse.json();
                    // Filter out completed custom requests
                    const activeCustomRequests = (customData.requests || []).filter(request => request.status !== 'completed');
                    allRequests = allRequests.concat(activeCustomRequests);
                }
                
                // Add orders with custom input
                if (customOrdersResponse && customOrdersResponse.ok) {
                    const ordersData = await customOrdersResponse.json();
                    const customOrders = (ordersData.orders || [])
                        .filter(order => order.order_status !== 'completed') // Filter out completed orders
                        .map(order => ({
                            id: `order_${order.id}`,
                            type: 'order',
                            customer_name: order.customer_name,
                            product_type: order.product_name,
                            concept_description: formatCustomInputDescription(order.custom_input),
                            quantity: order.quantity,
                            timeline: 'standard',
                            budget_range: `$${order.total_price}`,
                            status: order.order_status || 'pending', // Ensure status is always defined
                            created_at: order.created_at || new Date().toISOString(), // Use actual order date if available
                            email: order.customer_email,
                            order_number: order.order_number
                        }));
                    allRequests = allRequests.concat(customOrders);
                }
                
                // Sort by creation date (newest first)
                allRequests.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                
                // Take the first 5
                allRequests = allRequests.slice(0, 5);
                
                updateCustomRequests(allRequests);
            } catch (error) {
                console.error('Error loading custom requests:', error);
            }
        }

        // Update custom requests
        function updateCustomRequests(requests) {
            const container = document.getElementById('customRequestsContainer');
            const loading = document.getElementById('customRequestsLoading');
            const empty = document.getElementById('customRequestsEmpty');
            
            if (!container) {
                console.error('Container not found!');
                return;
            }
            
            // Hide loading
            if (loading) {
                loading.classList.add('hidden');
            }
            
            if (!requests || requests.length === 0) {
                console.log('ðŸ” No requests found, showing empty state');
                // Show empty state
                if (empty) {
                    empty.classList.remove('hidden');
                    console.log('ðŸ” Empty state shown');
                } else {
                    console.log('âŒ Empty element not found');
                }
                return;
            }
            
            // Hide empty state
            if (empty) empty.classList.add('hidden');
            
            container.innerHTML = requests.map(request => {
                // Map status to proper CSS class and display text
                let statusClass, statusText;
                switch(request.status) {
                    case 'pending':
                        statusClass = 'status-pending';
                        statusText = 'Pending';
                        break;
                    case 'processing':
                        statusClass = 'status-processing';
                        statusText = 'Processing';
                        break;
                    case 'shipped':
                        statusClass = 'status-shipped';
                        statusText = 'Shipped';
                        break;
                    case 'completed':
                        statusClass = 'status-completed';
                        statusText = 'Completed';
                        break;
                    case 'urgent':
                        statusClass = 'status-urgent';
                        statusText = 'Urgent';
                        break;
                    default:
                        statusClass = 'status-pending';
                        statusText = 'Pending';
                }
                
                const timelineText = request.timeline === 'rush' ? 'Rush' : 
                                   request.timeline === 'express' ? 'Express' : 'Standard';
                
                return `
                    <div class="p-4 bg-surface-dark rounded-lg border border-accent border-opacity-30">
                        <div class="flex items-center justify-between mb-2">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                            <span class="text-text-secondary text-xs">${formatTimeAgo(request.created_at)}</span>
                        </div>
                        <h4 class="text-white font-medium text-sm mb-2">${request.customer_name} - ${request.product_type}</h4>
                        <p class="text-text-secondary text-xs mb-2">${request.concept_description.substring(0, 100)}${request.concept_description.length > 100 ? '...' : ''}</p>
                        <div class="flex items-center justify-between text-xs mb-2">
                            <span class="text-text-secondary">Qty: ${request.quantity}</span>
                            <span class="text-text-secondary">Timeline: ${timelineText}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-accent font-bold text-sm">Budget: ${request.budget_range}</span>
                            ${request.type === 'order' ? 
                                `<button class="border border-accent text-accent px-3 py-1 rounded text-xs hover:bg-accent hover:text-black transition-all duration-300" onclick="viewOrderWithCustomInput('${request.order_number}')">View Order</button>` :
                                `<button class="btn-primary text-xs px-3 py-1" onclick="viewCustomRequest(${request.id})">View Details</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        // View order with custom input details
        window.viewOrderWithCustomInput = async function(orderNumber) {
            // Redirect to orders page and open the modal for this order
            window.location.href = `orders.html?highlight=${orderNumber}`;
        }

        // View custom request details
        async function viewCustomRequest(requestId) {
            try {
                const response = await apiRequest(`/api/custom-requests/${requestId}`);
                if (!response) return;
                
                const data = await response.json();
                
                if (response.ok) {
                    showCustomRequestModal(data.request);
                } else {
                    console.error('Error loading custom request details:', data.error);
                }
            } catch (error) {
                console.error('Error loading custom request details:', error);
            }
        }

        // Show custom request modal
        function showCustomRequestModal(request) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-orbitron text-xl font-bold text-white">Custom Request Details</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-text-secondary hover:text-accent">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-text-secondary text-sm">Customer Name</label>
                                <p class="text-white font-medium">${request.customer_name}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Email</label>
                                <p class="text-white font-medium">${request.email}</p>
                            </div>
                            ${request.phone ? `
                            <div>
                                <label class="text-text-secondary text-sm">Phone</label>
                                <p class="text-white font-medium">${request.phone}</p>
                            </div>
                            ` : ''}
                            <div>
                                <label class="text-text-secondary text-sm">Timeline</label>
                                <p class="text-white font-medium">${request.timeline}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Product Type</label>
                                <p class="text-white font-medium">${request.product_type}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Quantity</label>
                                <p class="text-white font-medium">${request.quantity}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Budget Range</label>
                                <p class="text-white font-medium">${request.budget_range}</p>
                            </div>
                        </div>
                        
                        <div>
                            <label class="text-text-secondary text-sm">Design Concept</label>
                            <p class="text-white mt-2">${request.concept_description}</p>
                        </div>
                        
                        ${request.additional_notes ? `
                        <div>
                            <label class="text-text-secondary text-sm">Additional Notes</label>
                            <p class="text-white mt-2">${request.additional_notes}</p>
                        </div>
                        ` : ''}
                        
                        ${request.style_preferences ? `
                        <div>
                            <label class="text-text-secondary text-sm">Style Preferences</label>
                            <p class="text-white mt-2">${JSON.parse(request.style_preferences).join(', ')}</p>
                        </div>
                        ` : ''}
                        
                        ${request.size_requirements ? `
                        <div>
                            <label class="text-text-secondary text-sm">Size Requirements</label>
                            <p class="text-white mt-2">${JSON.parse(request.size_requirements).join(', ')}</p>
                        </div>
                        ` : ''}
                        
                        ${request.color_preferences ? `
                        <div>
                            <label class="text-text-secondary text-sm">Color Preferences</label>
                            <p class="text-white mt-2">${request.color_preferences}</p>
                        </div>
                        ` : ''}
                        
                        ${request.reference_images ? `
                        <div>
                            <label class="text-text-secondary text-sm">Reference Images</label>
                            <div class="grid grid-cols-2 gap-2 mt-2">
                                ${JSON.parse(request.reference_images).map(img => `
                                    <div class="bg-surface-dark p-2 rounded">
                                        <p class="text-xs text-text-secondary">${img.name}</p>
                                        <p class="text-xs text-text-secondary">${(img.size / 1024).toFixed(1)} KB</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="flex justify-between items-center pt-4 border-t border-surface-light">
                            <div>
                                <span class="status-badge status-${request.status}">${request.status}</span>
                                <span class="text-text-secondary text-sm ml-2">Created: ${new Date(request.created_at).toLocaleString()}</span>
                            </div>
                            <div class="space-x-2">
                                <button onclick="updateRequestStatus(${request.id}, 'processing')" class="btn-primary text-sm px-4 py-2">Start Processing</button>
                                <button onclick="sendQuote(${request.id})" class="border border-accent text-accent px-4 py-2 rounded text-sm hover:bg-accent hover:text-black transition-all duration-300">Send Quote</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Update request status
        async function updateRequestStatus(requestId, status) {
            try {
                const response = await apiRequest(`/api/custom-requests/${requestId}/status`, {
                    method: 'PATCH',
                    body: JSON.stringify({ status })
                });
                
                if (response && response.ok) {
                    showNotification('Request status updated successfully', 'success');
                    loadCustomRequests(); // Refresh the list
                    
                    // If request was marked as completed, refresh dashboard metrics to update custom requests count
                    if (status === 'completed') {
                        await loadDashboardData();
                    }
                } else {
                    showNotification('Failed to update request status', 'error');
                }
            } catch (error) {
                console.error('Error updating request status:', error);
                showNotification('Error updating request status', 'error');
            }
        }

        // Refresh custom requests count
        async function refreshCustomRequestsCount() {
            try {
                await loadDashboardData();
                showNotification('Custom requests count refreshed', 'success');
            } catch (error) {
                console.error('Error refreshing custom requests count:', error);
                showNotification('Error refreshing count', 'error');
            }
        }

        // Show order details modal
        async function showOrderDetails(orderId) {
            try {
                const response = await apiRequest(`/api/orders/${orderId}`);
                if (!response) return;
                
                const data = await response.json();
                
                if (response.ok) {
                    showOrderDetailsModal(data.order);
                } else {
                    showNotification('Failed to load order details', 'error');
                }
            } catch (error) {
                console.error('Error loading order details:', error);
                showNotification('Error loading order details', 'error');
            }
        }

        // Show order details modal
        function showOrderDetailsModal(order) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-orbitron text-xl font-bold text-white">Order Details - ${order.order_number}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-text-secondary hover:text-accent">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="text-accent font-medium mb-2">Customer Information</h4>
                            <div class="space-y-2 text-sm">
                                <p><span class="text-text-secondary">Name:</span> <span class="text-white">${order.customer_name || 'N/A'}</span></p>
                                <p><span class="text-text-secondary">Email:</span> <span class="text-white">${order.customer_email || 'N/A'}</span></p>
                                <p><span class="text-text-secondary">Order Date:</span> <span class="text-white">${new Date(order.created_at).toLocaleString()}</span></p>
                                <p><span class="text-text-secondary">Status:</span> <span class="status-badge status-${order.status}">${order.status}</span></p>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-accent font-medium mb-2">Order Summary</h4>
                            <div class="space-y-2 text-sm">
                                <p><span class="text-text-secondary">Total Amount:</span> <span class="text-accent font-bold">$${parseFloat(order.total_amount || 0).toFixed(2)}</span></p>
                                <p><span class="text-text-secondary">Items:</span> <span class="text-white">${order.item_count || 0}</span></p>
                                <p><span class="text-text-secondary">Order Number:</span> <span class="text-white font-mono">${order.order_number}</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-accent font-medium mb-3">Order Items</h4>
                        <div class="space-y-3">
                            ${order.order_items && order.order_items.length > 0 ? order.order_items.map(item => `
                                <div class="bg-surface-dark p-4 rounded-lg">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <h5 class="text-white font-medium">${item.product_name}</h5>
                                            <div class="text-sm text-text-secondary space-y-1 mt-2">
                                                <p>Quantity: ${item.quantity}</p>
                                                ${item.size ? `<p>Size: ${item.size}</p>` : ''}
                                                ${item.color ? `<p>Color: ${item.color}</p>` : ''}
                                                ${item.custom_input ? `<p class="text-accent">Custom Input: ${JSON.stringify(item.custom_input)}</p>` : ''}
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-accent font-bold">$${parseFloat(item.unit_price || 0).toFixed(2)} each</p>
                                            <p class="text-white font-medium">$${parseFloat(item.total_price || 0).toFixed(2)} total</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('') : '<p class="text-text-secondary">No order items found</p>'}
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-text-secondary hover:text-accent transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }






        // Toggle order view between compact and expanded
        function toggleOrderView() {
            const columns = document.querySelectorAll('.kanban-column');
            const toggleBtn = document.getElementById('orderViewToggle');
            const isCompact = toggleBtn.textContent === 'Compact View';
            
            columns.forEach(column => {
                const orderContainer = column.querySelector('.space-y-3');
                if (orderContainer) {
                    if (isCompact) {
                        // Switch to expanded view
                        orderContainer.classList.remove('max-h-96');
                        orderContainer.classList.add('max-h-screen');
                        toggleBtn.textContent = 'Compact View';
                    } else {
                        // Switch to compact view
                        orderContainer.classList.remove('max-h-screen');
                        orderContainer.classList.add('max-h-96');
                        toggleBtn.textContent = 'Expanded View';
                    }
                }
            });
        }

        // Send quote (placeholder function)
        function sendQuote(requestId) {
            showNotification('Quote functionality coming soon!', 'info');
        }

        // Auto-refresh dashboard data
        setInterval(loadDashboardData, 30000);

        // Kanban drag and drop simulation
        const kanbanCards = document.querySelectorAll('.kanban-card');
        kanbanCards.forEach(card => {
            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', '');
                card.style.opacity = '0.5';
            });

            card.addEventListener('dragend', () => {
                card.style.opacity = '1';
            });
        });

        // Real-time notifications simulation
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-success' : 
                type === 'warning' ? 'bg-warning' : 
                type === 'error' ? 'bg-error' : 'bg-accent'
            } text-white`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Simulate new orders
        setInterval(() => {
            if (Math.random() > 0.7) {
                showNotification('New order received!', 'success');
            }
        }, 60000);

        // Chart animation on load
        document.addEventListener('DOMContentLoaded', () => {
            const chartLine = document.querySelector('polyline');
            if (chartLine) {
                const length = chartLine.getTotalLength();
                chartLine.style.strokeDasharray = length;
                chartLine.style.strokeDashoffset = length;
                
                setTimeout(() => {
                    chartLine.style.transition = 'stroke-dashoffset 2s ease-in-out';
                    chartLine.style.strokeDashoffset = 0;
                }, 500);
            }
        });

        // Progress bar animations
        const progressBars = document.querySelectorAll('.progress-fill');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const width = entry.target.style.width;
                    entry.target.style.width = '0%';
                    setTimeout(() => {
                        entry.target.style.width = width;
                    }, 100);
                }
            });
        });

        progressBars.forEach(bar => observer.observe(bar));

        // Newsletter Subscribers Management
        const refreshSubscribersBtn = document.getElementById('refreshSubscribers');
        const exportSubscribersBtn = document.getElementById('exportSubscribers');
        const subscribersTableBody = document.getElementById('subscribersTableBody');
        const subscriberCount = document.getElementById('subscriberCount');
        const subscribersLoading = document.getElementById('subscribersLoading');
        const subscribersEmpty = document.getElementById('subscribersEmpty');

        async function loadSubscribers() {
            try {
                subscribersLoading.classList.remove('hidden');
                subscribersTableBody.innerHTML = '';
                subscribersEmpty.classList.add('hidden');

                const response = await apiRequest('/api/subscribers');
                if (!response) { subscribersLoading.classList.add('hidden'); return; }
                const data = await response.json();

                if (response.ok) {
                    const subscribers = data.subscribers;
                    subscriberCount.textContent = subscribers.length;

                    if (subscribers.length === 0) {
                        subscribersEmpty.classList.remove('hidden');
                    } else {
                        subscribers.forEach(subscriber => {
                            const row = document.createElement('tr');
                            row.className = 'border-b border-surface-light hover:bg-surface-dark transition-colors';
                            
                            const subscribedDate = new Date(subscriber.subscribed_at).toLocaleDateString();
                            const status = subscriber.is_active ? 'Active' : 'Inactive';
                            const statusClass = subscriber.is_active ? 'text-success' : 'text-text-secondary';
                            const welcomeEmail = subscriber.welcome_email_sent ? 'Sent' : 'Pending';
                            const welcomeClass = subscriber.welcome_email_sent ? 'text-success' : 'text-warning';

                            row.innerHTML = `
                                <td class="py-3 text-white">${subscriber.email}</td>
                                <td class="py-3 text-text-secondary">${subscriber.name || '-'}</td>
                                <td class="py-3 text-text-secondary">${subscribedDate}</td>
                                <td class="py-3 ${statusClass}">${status}</td>
                                <td class="py-3 ${welcomeClass}">${welcomeEmail}</td>
                                <td class="py-3">
                                    <button class="text-accent hover:text-accent-light text-sm" onclick="resendWelcomeEmail('${subscriber.email}')">
                                        Resend Welcome
                                    </button>
                                </td>
                            `;
                            
                            subscribersTableBody.appendChild(row);
                        });
                    }
                } else {
                    showNotification('Error loading subscribers', 'error');
                }
            } catch (error) {
                console.error('Error loading subscribers:', error);
                showNotification('Network error loading subscribers', 'error');
            } finally {
                subscribersLoading.classList.add('hidden');
            }
        }

        async function resendWelcomeEmail(email) {
            try {
                const response = await fetch('/api/subscribe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });

                if (response.ok) {
                    showNotification('Welcome email resent successfully!', 'success');
                } else {
                    showNotification('Error resending welcome email', 'error');
                }
            } catch (error) {
                console.error('Error resending welcome email:', error);
                showNotification('Network error resending email', 'error');
            }
        }

        function exportSubscribersCSV() {
            const table = document.querySelector('table');
            const rows = table.querySelectorAll('tbody tr');
            
            let csv = 'Email,Name,Subscribed,Status,Welcome Email\n';
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const email = cells[0].textContent;
                const name = cells[1].textContent;
                const subscribed = cells[2].textContent;
                const status = cells[3].textContent;
                const welcomeEmail = cells[4].textContent;
                
                csv += `"${email}","${name}","${subscribed}","${status}","${welcomeEmail}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'subscribers.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Subscribers exported successfully!', 'success');
        }

        // Event listeners
        if (refreshSubscribersBtn) {
            refreshSubscribersBtn.addEventListener('click', loadSubscribers);
        }

        if (exportSubscribersBtn) {
            exportSubscribersBtn.addEventListener('click', exportSubscribersCSV);
        }

        const exportOrdersBtn = document.getElementById('exportOrdersBtn');
        if (exportOrdersBtn) {
            exportOrdersBtn.addEventListener('click', async () => {
                const token = localStorage.getItem('adminToken');
                if (!token) { return window.location.href = 'admin-login.html'; }
                const periodSel = document.getElementById('sales-period');
                const period = periodSel ? periodSel.value : '7d';
                try {
                    const res = await fetch(`/api/orders/export?period=${encodeURIComponent(period)}`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!res.ok) {
                        showNotification('Export failed', 'error');
                        return;
                    }
                    const blob = await res.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `orders_${period}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);
                    showNotification('Orders exported', 'success');
                } catch (e) {
                    console.error('Export error', e);
                    showNotification('Network error exporting', 'error');
                }
            });
        }

        const processAllOrdersBtn = document.getElementById('processAllOrdersBtn');
        if (processAllOrdersBtn) {
            processAllOrdersBtn.addEventListener('click', async () => {
                const ok = confirm('Move all pending orders to processing?');
                if (!ok) return;
                try {
                    const response = await apiRequest('/api/orders/process-all', { method: 'POST' });
                    const data = response ? await response.json() : null;
                    if (response && response.ok) {
                        showNotification(`${data.moved || 0} orders moved to processing`, 'success');
                        loadOrders();
                    } else {
                        showNotification('Failed to process orders', 'error');
                    }
                } catch (e) {
                    console.error('Error processing orders:', e);
                    showNotification('Error processing orders', 'error');
                }
            });
        }

        // Notifications
        const notifBtn = document.getElementById('notifBtn');
        const notifDropdown = document.getElementById('notifDropdown');
        const notifList = document.getElementById('notifList');
        const notifEmpty = document.getElementById('notifEmpty');
        const markAllRead = document.getElementById('markAllRead');

        async function loadNotifications() {
            try {
                const res = await apiRequest('/api/admin/notifications?unread=true');
                if (!res) return;
                const data = await res.json();
                const items = (data && data.notifications) || [];
                if (!items.length) {
                    if (notifEmpty) notifEmpty.classList.remove('hidden');
                    if (notifList) notifList.innerHTML = '';
                    return;
                }
                if (notifEmpty) notifEmpty.classList.add('hidden');
                if (notifList) {
                    notifList.innerHTML = items.map(n => {
                        const href = resolveNotifLink(n.link);
                        const title = n.title || n.type || 'Notification';
                        const body = n.body ? `<div class=\"text-text-secondary text-xs mt-1\">${n.body}</div>` : '';
                        return `
                        <a href=\"${href}\" class=\"block p-2 bg-surface-dark rounded border border-surface-light hover:bg-surface-light\" onclick=\"document.getElementById('notifDropdown').classList.add('hidden')\">\n                            <div class=\"flex items-center justify-between\">\n                                <span class=\"text-white text-xs font-medium\">${title}</span>\n                                <span class=\"text-text-secondary text-2xs\">${formatTimeAgo(n.created_at)}</span>\n                            </div>\n                            ${body}\n                        </a>`;
                    }).join('');
                }
            } catch (e) { console.error('Load notifications error', e); }
        }

        if (notifBtn) {
            notifBtn.addEventListener('click', async () => {
                notifDropdown.classList.toggle('hidden');
                if (!notifDropdown.classList.contains('hidden')) {
                    await loadNotifications();
                }
            });
        }
        if (markAllRead) {
            markAllRead.addEventListener('click', async () => {
                try {
                    const res = await apiRequest('/api/admin/notifications/read', { method: 'PATCH' });
                    if (res && res.ok) {
                        await loadNotifications();
                        showNotification('All notifications marked as read', 'success');
                    }
                } catch (e) { console.error('Mark all read error', e); }
            });
        }

        function resolveNotifLink(link) {
            if (!link) return '#';
            if (link.startsWith('order:')) {
                const id = link.split(':')[1];
                return `orders.html?orderId=${encodeURIComponent(id)}`;
            }
            return '#';
        }



        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Check authentication
            if (!checkAuth()) return;
            
            // Load all dashboard data
            loadDashboardData();
            loadOrders();
            // loadCustomRequests(); // Commented out duplicate call
            loadSubscribers();
            loadActivity();
            loadSalesSeries('7d');
            
            // Add logout functionality to profile
            const profileSection = document.querySelector('.flex.items-center.space-x-3');
            if (profileSection) {
                const logoutBtn = document.createElement('button');
                logoutBtn.className = 'text-text-secondary hover:text-accent text-sm transition-colors';
                logoutBtn.textContent = 'Logout';
                logoutBtn.onclick = logout;
                profileSection.appendChild(logoutBtn);
            }
            // Period selector
            const periodSel = document.getElementById('sales-period');
            if (periodSel) {
                periodSel.addEventListener('change', () => { loadSalesSeries(periodSel.value); loadDashboardData(); });
            }
        });

        const refreshActivityBtn = document.getElementById('refreshActivity');
        if (refreshActivityBtn) {
            refreshActivityBtn.addEventListener('click', loadActivity);
        }
    </script>
<script id="dhws-dataInjector" src="/public/mobile-menu-injector.js?v=20250809d"></script>
<script>
  if (!window.__DHWS_INJECTOR_VERSION__) {
    var s = document.createElement('script');
    s.src = (location.pathname.includes('/pages/') ? '../public/mobile-menu-injector.js?v=20250809d' : 'public/mobile-menu-injector.js?v=20250809d');
    document.head.appendChild(s);
          }

        // Test custom input API endpoints
        async function testCustomInputAPI() {
            try {
                console.log('ðŸ§ª Testing Custom Input API endpoints...');
                
                // Test custom requests endpoint
                console.log('ðŸ§ª Testing /api/custom-requests...');
                const customRequestsResponse = await apiRequest('/api/custom-requests?limit=3');
                console.log('ðŸ§ª Custom requests response:', customRequestsResponse);
                
                if (customRequestsResponse && customRequestsResponse.ok) {
                    const customData = await customRequestsResponse.json();
                    console.log('ðŸ§ª Custom requests data:', customData);
                }
                
                // Test orders with custom input endpoint
                console.log('ðŸ§ª Testing /api/orders/custom-input...');
                const customOrdersResponse = await apiRequest('/api/orders/custom-input?limit=3');
                console.log('ðŸ§ª Custom orders response:', customOrdersResponse);
                
                if (customOrdersResponse && customOrdersResponse.ok) {
                    const ordersData = await customOrdersResponse.json();
                    console.log('ðŸ§ª Orders with custom input data:', ordersData);
                }
                
                alert('API test completed! Check console for results.');
            } catch (error) {
                console.error('âŒ API test error:', error);
                alert('API test failed! Check console for error details.');
            }
        }

        // Format custom input for display
        function formatCustomInput(customInput) {
            if (!customInput || typeof customInput !== 'object') {
                return '<p class="text-text-secondary">No custom input provided</p>';
            }
            
            let html = '<div class="space-y-3">';
            
            // Handle lyrics custom input
            if (customInput.lyrics_song_name || customInput.lyrics_artist_band || customInput.lyrics_song_lyrics) {
                html += '<div class="border-l-4 border-accent pl-4">';
                html += '<h4 class="text-accent font-medium mb-2">ðŸŽµ Song Lyrics Request</h4>';
                if (customInput.lyrics_song_name) {
                    html += `<div class="mb-2"><span class="text-text-secondary text-sm">Song Name:</span> <span class="text-white">${customInput.lyrics_song_name}</span></div>`;
                }
                if (customInput.lyrics_artist_band) {
                    html += `<div class="mb-2"><span class="text-text-secondary text-sm">Artist/Band:</span> <span class="text-white">${customInput.lyrics_artist_band}</span></div>`;
                }
                if (customInput.lyrics_song_lyrics) {
                    html += `<div class="mb-2"><span class="text-text-secondary text-sm">Lyrics:</span> <div class="text-white bg-black bg-opacity-30 p-2 rounded mt-1 font-mono text-xs">${customInput.lyrics_song_lyrics}</div></div>`;
                }
                html += '</div>';
            }
            
            // Handle birthday custom input
            if (customInput.birthday_name || customInput.birthday_date || customInput.birthday_message) {
                html += '<div class="border-l-4 border-accent pl-4">';
                html += '<h4 class="text-accent font-medium mb-2">ðŸŽ‚ Birthday Request</h4>';
                if (customInput.birthday_name) {
                    html += `<div class="mb-2"><span class="text-text-secondary text-sm">Name:</span> <span class="text-white">${customInput.birthday_name}</span></div>`;
                }
                if (customInput.birthday_date) {
                    html += `<div class="mb-2"><span class="text-text-secondary text-sm">Birthday:</span> <span class="text-white">${customInput.birthday_date}</span></div>`;
                }
                if (customInput.birthday_message) {
                    html += `<div class="mb-2"><span class="text-text-secondary text-sm">Message:</span> <div class="text-white bg-black bg-opacity-30 p-2 rounded mt-1">${customInput.birthday_message}</div></div>`;
                }
                html += '</div>';
            }
            
            // Handle any other custom input fields
            const otherFields = Object.keys(customInput).filter(key => 
                !key.startsWith('lyrics_') && !key.startsWith('birthday_')
            );
            
            if (otherFields.length > 0) {
                html += '<div class="border-l-4 border-accent pl-4">';
                html += '<h4 class="text-accent font-medium mb-2">ðŸ“ Additional Custom Input</h4>';
                otherFields.forEach(field => {
                    const value = customInput[field];
                    if (value && value !== 'null' && value !== 'undefined') {
                        const label = field.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        html += `<div class="mb-2"><span class="text-text-secondary text-sm">${label}:</span> <span class="text-white">${value}</span></div>`;
                    }
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }
        
        // Format order date
        function formatOrderDate(order) {
            // Try to get date from order_items table first
            if (order.created_at) {
                try {
                    return new Date(order.created_at).toLocaleString();
                } catch (e) {
                    console.warn('Invalid created_at date:', order.created_at);
                }
            }
            
            // Fallback: use current time since we don't have the actual order date
            return new Date().toLocaleString() + ' (estimated)';
        }

        // View order with custom input
        async function viewOrderWithCustomInput(orderNumber) {
            try {
                const response = await apiRequest(`/api/orders/custom-input`);
                if (!response) return;
                
                const data = await response.json();
                const order = data.orders.find(o => o.order_number === orderNumber);
                
                if (order) {
                    showOrderWithCustomInputModal(order);
                } else {
                    console.error('Order not found');
                }
            } catch (error) {
                console.error('Error loading order details:', error);
            }
        }

        // Show order with custom input modal
        function showOrderWithCustomInputModal(order) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass-card rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-orbitron text-xl font-bold text-white">Order with Custom Input</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-text-secondary hover:text-accent">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-text-secondary text-sm">Order Number</label>
                                <p class="text-white font-medium">${order.order_number}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Customer Name</label>
                                <p class="text-white font-medium">${order.customer_name}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Email</label>
                                <p class="text-white font-medium">${order.customer_email}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Product</label>
                                <p class="text-white font-medium">${order.product_name}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Quantity</label>
                                <p class="text-white font-medium">${order.quantity}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Total</label>
                                <p class="text-white font-medium">$${order.total_price}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Size</label>
                                <p class="text-white font-medium">${order.size}</p>
                            </div>
                            <div>
                                <label class="text-text-secondary text-sm">Color</label>
                                <p class="text-white font-medium">${order.color}</p>
                            </div>
                        </div>
                        
                        <div>
                            <label class="text-text-secondary text-sm">Custom Input Details</label>
                            <div class="bg-surface-dark p-4 rounded-lg mt-2">
                                ${formatCustomInput(order.custom_input)}
                            </div>
                        </div>
                        
                        <div>
                            <label class="text-text-secondary text-sm">Order Date</label>
                            <p class="text-white font-medium">${formatOrderDate(order)}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>